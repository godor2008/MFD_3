# MFD_3
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/MFD/Image/small_buttons.jpg)

This is MFCD board for JF-17 module used in DCS World. It is similar to Thrustmaster Cougar panel, but larger. Designed to be used with 9.7 inch monitor 4:3 1024x768
Designed in Altium Designer 20

Contains output files (Gerber) and elements list for production at https://jlcpcb.com/

[Gerber zip archive](https://github.com/godor2008/MFD_3/blob/small_buttons/MFD/Project%20Outputs%20for%20Mfd3/Project%20Outputs%20for%20Mfd3.zip)
---------------
[BOM](https://github.com/godor2008/MFD_3/blob/small_buttons/MFD/Project%20Outputs%20for%20Mfd3/Bill%20of%20Materials-Mfd3.xlsx)
-------------
[Pick and Place file](https://github.com/godor2008/MFD_3/blob/small_buttons/MFD/Project%20Outputs%20for%20Mfd3/Pick%20Place%20for%20Mfd3.csv)
-----------
You may download these files and use them to order boards with SMT asssembly at https://jlcpcb.com/

Buttons you have to solder yourself.

Button used is 6*6 tactile switch with built-in LED. For example I used this https://www.aliexpress.com/item/32947533283.html
But you may find other similar buttons at alibaba.com or your local shop.
You may also add simple keycaps, for example I used this https://www.aliexpress.com/item/32918071718.html

Firmware is developed by FreeJoy https://github.com/FreeJoy-Team/FreeJoyWiki
Take a look at that project. 

Firmware may be downloaded [here](https://github.com/godor2008/MFD_3/blob/small_buttons/MFD/Firmware/FreeJoy_v1_7_1b3.hex)

This is [configuration](https://github.com/godor2008/MFD_3/blob/small_buttons/MFD/Firmware/new_FreeJoyLeft.cfg) file that contains mappings between physical and logical buttons. Should be uploaded through FreeJoy configurator after programming firmware.

Additionally you'll need to order:
Tiny [HDMI](https://vi.aliexpress.com/item/33057698628.html) 10 cm cable for extension inside case. Order 2 A1 connectors and 10cm cable
![image](https://github.com/godor2008/MFD_3/assets/1040630/173b196d-916a-4216-9e6a-b11b741dd1af)

[XH 2.54 20 cm cables](https://vi.aliexpress.com/item/1005002160765607.html) for usb extension. Order 1 pack of each color

[XH 2.54 4 pin angled connectors set](https://vi.aliexpress.com/item/4000029752260.html) for usb extension. You need only two of them, so order minimal pack you can
![image](https://github.com/godor2008/MFD_3/assets/1040630/b1e457af-7536-40e4-b954-ec63185189ee)

[Usb Connector B Type vertical](https://vi.aliexpress.com/item/32947971157.html)
![image](https://github.com/godor2008/MFD_3/assets/1040630/5e891ae7-79d2-415f-b64a-cc2c8a94e054)





# Some assembly process:

# Middle plate
Make countersink holes so screw perfecty fits in it:
![image](https://github.com/godor2008/MFD_3/assets/1040630/c6b313ae-16f2-4fa6-8e5a-dd94683cdaaf)

Prepare 19 **brass 20mm standoffs** and 19 **M3 8mm screws**:
![image](https://github.com/godor2008/MFD_3/assets/1040630/30bbc73b-e3de-4bdf-82d5-37a4c2673435)

![image](https://github.com/godor2008/MFD_3/assets/1040630/4c4778ec-4bcc-4461-99d4-3b523ac12dd3)

![image](https://github.com/godor2008/MFD_3/assets/1040630/f4dcfc7c-a225-43a4-adcb-48c940849672)

![image](https://github.com/godor2008/MFD_3/assets/1040630/8f3b9fde-597b-4e88-ace9-6cad563f495e)

Prepare 11 **M3 10mm screws**, 11 **M3 nuts with washer**, 11 **M3 nylon locking nuts**, 11 **small plates from steel 0.8mm-1mm** that will be used to hold LCD on place.
![20240325_023449](https://github.com/godor2008/MFD_3/assets/1040630/51011179-de8f-4617-a918-5ee8e36b7897)



![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/1.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/2.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/3.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/4.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/5.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/6.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/7.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/8.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/9.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/10.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/11.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/12.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/13.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/14.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/15.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/16.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/17.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/18.jpg)
![Image](https://github.com/godor2008/MFD_3/blob/small_buttons/Images/19.jpg)

# HDMI board
Solder **HDMI 47659-1102 Molex** connector and **FFC/FPC 20pin 0.5mm** connector to board. Use board P16. You may use any from the set depending on your prefferable connectors.
![20240318_194333](https://github.com/godor2008/MFD_3/assets/1040630/582cd13c-38ed-4669-8924-e5e7b32522d2)

Then prepare:
2 **M3 nylon locking nuts** and 2 **M3 Threaded Hex Brass Male Female Standoff 7mm**
![20240320_214720](https://github.com/godor2008/MFD_3/assets/1040630/60fbdf5e-7507-4745-a043-6cb139f78a28)

And assemble it:
![20240320_212444](https://github.com/godor2008/MFD_3/assets/1040630/1f68242c-530f-41b7-8fcf-dabf474bb29f)

# USB board
Solder **USB-B vertical** and **XH JST 2.54 4 pin male right angled connector**
![image](https://github.com/godor2008/MFD_3/assets/1040630/d5dbbd9d-60c8-45d6-afd0-b7f21dc5c638)

Then prepare:
2 **M3 nylon locking nuts**, 2 **M3 Threaded Hex Brass Male Female Standoff 14mm**, 2 **M3 washer**. Washers are needed to perfectly match height of USB connector
![image](https://github.com/godor2008/MFD_3/assets/1040630/1d336fee-7463-4753-b97d-260d3659b9c4)

And assemble it:
![image](https://github.com/godor2008/MFD_3/assets/1040630/5c7c7a5b-8d20-4427-ae99-c572f131d0af)

# USB cable
Prepare 2 **XH JST 2.54 4 pin female connector** and 4 **XH JST 2.54 20 cm cable**
![20240321_224224](https://github.com/godor2008/MFD_3/assets/1040630/f0f27c17-81c7-445b-afd2-94a185c74f62)

Then assemble it. Pay attention that green and white wires not symmetrical
![20240321_224901](https://github.com/godor2008/MFD_3/assets/1040630/ea61a222-f7c9-44fc-8069-09cbf0b823e0)

Now connect cable to USB board:
![image](https://github.com/godor2008/MFD_3/assets/1040630/f8eb0d91-fd96-4ca6-bd59-a634d54a4519)


# Loading Firmware
Connect STM32 ST-Link programmer to board: SWDIO, SWCLK, GND, +3.3V

Open STM32 ST-Link Utility
![1](https://github.com/godor2008/MFD_3/assets/1040630/72e319e2-51bf-417a-9948-aeecdd1d2d20)

Click _Target_ - _Connect_. You should see valid messages in console if connected.
![2](https://github.com/godor2008/MFD_3/assets/1040630/5790aa64-33a8-4812-b055-b9d173722265)

Click _File_ - _Open file_
![3](https://github.com/godor2008/MFD_3/assets/1040630/183861bc-f738-41be-8c64-873bdd729da9)

Select *.hex file and click _Open_
![4](https://github.com/godor2008/MFD_3/assets/1040630/5dcb3db9-2086-45fb-8edf-166367ab9e80)

Now _Target_ - _Program & Verify..._
![5](https://github.com/godor2008/MFD_3/assets/1040630/991af21f-1d66-4d5c-85ef-e48dbe9841f8)

Click _Start_
![6](https://github.com/godor2008/MFD_3/assets/1040630/03ba9cfc-1483-4450-b08f-2b0fdb4f8601)

Progress bar should become green and when done window may be closed. You should see _Verification...OK_ in console
![7](https://github.com/godor2008/MFD_3/assets/1040630/f1cc01d1-81e1-42c1-85d1-2551a7eef540)

Now disconnect STM32 programmer from board.

# Loading Configuration
Connect board via USB and launch FreeJoyQt configurator. It should have green box and deafult name FreeJoy with version. It means firmware is present on board and we can now upload our configuration for buttons.
![8](https://github.com/godor2008/MFD_3/assets/1040630/75b31efc-5461-4b93-8bf7-e2c6796762a8)

Click on _Load config from file_. Navigate to config file and click _Open_
![9](https://github.com/godor2008/MFD_3/assets/1040630/12965241-829c-4571-b183-be4f7e941bdb)

Now click on _Write config to Device_
![10](https://github.com/godor2008/MFD_3/assets/1040630/822ce6a0-0388-41bc-8fe3-1518a46afda4)

After successful write, default name on top should change to one of _FreeJoyLeft_/_FreeJoyCenter_/_FreeJoyRight_
![11](https://github.com/godor2008/MFD_3/assets/1040630/799f16e5-ce93-47f8-b614-d717b4d418a2)

Repeat above steps for each MFD by selecting corresponding configuration file. Only things that differ between files are _DeviceName_ and _USB PID_. Different _USB PID_ is required so Windows could distinguish multiple devices when they are connected same time. These settings may be changed in _Advanced_ tab:
![12](https://github.com/godor2008/MFD_3/assets/1040630/0a9a4589-8b8d-4bb4-a121-796a16b3383a)
